% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/archive_table.R
\name{archive_table}
\alias{archive_table}
\title{Archive a data object to multiple formats (robust to per-format failures)}
\usage{
archive_table(
  data,
  path_out,
  extensions = c(csv = ".csv", rds = ".RDS", sqlite = ".db", xlsx = ".xlsx"),
  table_nm = c(NA, "r_data"),
  do_csv = TRUE,
  do_rds = TRUE,
  do_sqlite = TRUE,
  do_xlsx = TRUE,
  increment = TRUE,
  use_subdirs = FALSE,
  row.names = FALSE,
  stop_on_error = FALSE
)
}
\arguments{
\item{data}{Data frame or `sf` object to archive.}

\item{path_out}{Character. Base path (without extension) for output files.}

\item{extensions}{Named character vector of file extensions. Defaults to
`c(csv = ".csv", rds = ".RDS", sqlite = ".db", xlsx = ".xlsx")`.}

\item{table_nm}{Character or NA. Table name for SQLite export and sheet name for XLSX export.
If `NA`, defaults to the base name of `path_out`.}

\item{do_csv}{Logical. If `TRUE`, write CSV file (default = `TRUE`).}

\item{do_rds}{Logical. If `TRUE`, write RDS file (default = `TRUE`).}

\item{do_sqlite}{Logical. If `TRUE`, write SQLite file (default = `TRUE`).}

\item{do_xlsx}{Logical. If `TRUE`, write XLSX file (default = `TRUE`).}

\item{increment}{Logical. If `TRUE`, increment version numbers in filenames (default = `TRUE`).}

\item{use_subdirs}{Logical. If `TRUE`, create subdirectories for each format (default = `FALSE`).}

\item{row.names}{Logical. If `TRUE`, include row names in CSV and XLSX outputs (default = `FALSE`).}

\item{stop_on_error}{Logical. If `TRUE`, rethrow on first write error; otherwise collect errors and continue (default = `FALSE`).}
}
\value{
Invisibly returns a named list per format with `success`, `path` (if any), and `error` (if any).
}
\description{
Saves a given data object to specified formats (CSV, RDS, SQLite, XLSX) with versioned filenames.
 Each format write is isolated so one failure does not stop others. Detailed
 per-format status is returned (success/path/error).
}
\details{
- CSV and RDS files are written using `write.csv()` and `saveRDS()`.
 - XLSX export uses `openxlsx::write.xlsx()` with sheet name = `table_nm` clipped to 30 chars.
 - SQLite export uses `sf::st_write()` (requires `data` to be an `sf` object).
 - If `table_nm = NA`, the base name of `path_out` is used for sheet/table names.
 - Row names are excluded by default in CSV and XLSX outputs (`row.names = FALSE`).
 - Filenames are versioned using `file_version()`.
 - If `use_subdirs = TRUE`, files are placed in subdirectories named after their format (e.g., `csv/`, `rds/`), which are created if needed.
 - Column names are normalized for duplicate detection (case-insensitive). If duplicates exist after converting to lowercase, numeric suffixes (.2, .3, ...) are appended.
 - Each writer uses `tryCatch()` to capture and report failures without stopping the function unless `stop_on_error = TRUE`.

 This program is free software but it is provided WITHOUT WARRANTY
 and with ABSOLUTELY NO GUARANTEE of fitness or functionality for any purpose;
 you can redistribute it and/or modify it under the terms of the GNU
 General Public License as published by the Free Software Foundation;
 either version 2 of the License, or (at your option) any later version.

\cr
Revision History
\tabular{ll}{
1.8 \tab 2025-11-03 Add per-format tryCatch, stop_on_error, and fixed subdir pathing. \cr
1.7 \tab 2025-11-03 Added sheet name clipping to 30 characters for XLSX. \cr
1.6 \tab 2025-11-03 Added duplicate column name handling logic. \cr
}
}
\examples{
 \dontrun{
   # Archive all formats in subdirectories, using base name for sheet/table
   archive_table(mtcars, "output/mydata", table_nm = NA, use_subdirs = TRUE)

   # Archive only CSV and XLSX with row names included; continue on errors
   archive_table(mtcars, "output/mydata", do_rds = FALSE, do_sqlite = FALSE, row.names = TRUE)

   # Fail fast on first error
   archive_table(mtcars, "output/mydata", stop_on_error = TRUE)
 }

}
\author{
Jacob Strunk <your.email@domain.com>
}
